describe("digest", function()
  local Digest = require "openssl-ffi.digest"
  local to_hex = require("resty.string").to_hex

  it("md4", function()
    local digest = Digest.new("md4")
    digest:update("hello")
    assert.equal("866437cb7a794bce2b727acc0362ee27", to_hex(digest:final()))
  end)

  it("md5", function()
    local digest = Digest.new("md5")
    digest:update("hello")
    assert.equal("5d41402abc4b2a76b9719d911017c592", to_hex(digest:final()))
  end)

  it("mdc2", function()
    local digest = Digest.new("mdc2")
    digest:update("hello")
    assert.equal("4517036cf97b2407d6fe22aa5ab878a3", to_hex(digest:final()))
  end)

  it("ripemd160", function()
    local digest = Digest.new("ripemd160")
    digest:update("hello")
    assert.equal("108f07b8382412612c048d07d13f814118445acd", to_hex(digest:final()))
  end)

  it("sha", function()
    local digest = Digest.new("sha")
    digest:update("hello")
    assert.equal("ac62a630ca850b4ea07eda664eaecf9480843152", to_hex(digest:final()))
  end)

  it("sha1", function()
    local digest = Digest.new("sha1")
    digest:update("hello")
    assert.equal("aaf4c61ddcc5e8a2dabede0f3b482cd9aea9434d", to_hex(digest:final()))
  end)

  it("sha224", function()
    local digest = Digest.new("sha224")
    digest:update("hello")
    assert.equal("ea09ae9cc6768c50fcee903ed054556e5bfc8347907f12598aa24193", to_hex(digest:final()))
  end)

  it("sha256", function()
    local digest = Digest.new("sha256")
    digest:update("hello")
    assert.equal("2cf24dba5fb0a30e26e83b2ac5b9e29e1b161e5c1fa7425e73043362938b9824", to_hex(digest:final()))
  end)

  it("sha384", function()
    local digest = Digest.new("sha384")
    digest:update("hello")
    assert.equal("59e1748777448c69de6b800d7a33bbfb9ff1b463e44354c3553bcdb9c666fa90125a3c79f90397bdf5f6a13de828684f", to_hex(digest:final()))
  end)

  it("sha512", function()
    local digest = Digest.new("sha512")
    digest:update("hello")
    assert.equal("9b71d224bd62f3785d96d46ad3ea3d73319bfbc2890caadae2dff72519673ca72323c3d99ba5c11d7c7acc6e14b8c5da0c4663475c2e5c3adef46f73bcdec043", to_hex(digest:final()))
  end)

  it("whirlpool", function()
    local digest = Digest.new("whirlpool")
    digest:update("hello")
    assert.equal("0a25f55d7308eca6b9567a7ed3bd1b46327f0f1ffdc804dd8bb5af40e88d78b88df0d002a89e2fdbd5876c523f1b67bc44e9f87047598e7548298ea1c81cfd73", to_hex(digest:final()))
  end)

  it("incremental updates", function()
    local digest = Digest.new("sha256")
    digest:update("hel")
    digest:update("lo")
    assert.equal("2cf24dba5fb0a30e26e83b2ac5b9e29e1b161e5c1fa7425e73043362938b9824", to_hex(digest:final()))
  end)

  it("no update", function()
    local digest = Digest.new("sha256")
    assert.equal("e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855", to_hex(digest:final()))
  end)

  it("empty string", function()
    local digest = Digest.new("sha256")
    digest:update("")
    assert.equal("e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855", to_hex(digest:final()))
  end)
end)
